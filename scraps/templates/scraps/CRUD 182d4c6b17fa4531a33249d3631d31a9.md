# CRUD

```python
class Article(models.Model):
    title = models.CharField(max_length=30)
    content = models.TextField()

    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
```

created랑 update에서 auto_now 두개 구분하기

---

## 어드민 생성

- python [manage.py](http://manage.py/) createsuperuser

- articles/admin.py

```python
from django.contrib import admin
from .models import Article
# Register your models here.

admin.site.register(Article)
```

---

## CRUD 구현

### shell

- from articles.models import Article (shell plus없으면 원래 이걸 해야 볼 수 있음)
- Article.objects.all()

## shell에서 content로 내용 보기

- articles/models.py

```python
class Article(models.Model):
    title = models.CharField(max_length=30)
    content = models.TextField()

    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    def __str__(self): # 이거로 하면 id, title를 리턴함
        return f'{self.id}번째글 - {self.title}'
```

---

## DB내용 출력하기

- articles/views.py

```java
from django.shortcuts import render
from .models import Article
# Create your views here.
def index(request):
    articles = Article.objects.all()
    context = {'articles' : articles}
    return render(request, 'articles/index.html', context)
```

- articles/index.html

```
{% extends 'base.html' %}

{% block content %}
<h1>INDEX</h1>

{% for article in articles %}
<p>글 번호: {{article.id}}</p>
<p>글 제목 : {{article.title}}</p>
<p>글 내용 : {{article.content}}</p>

{% endfor %}
{% endblock content %}
```

---

## 글 번호로 조회

- articles/urls.py

```python
from django.urls import path
from . import views
app_name = 'articles'
urlpatterns = [
    path('', views.index, name='index'),
    path('<int:id>/',views.detail, name='detail'),
]
```

- articles/views.py

```python
from django.shortcuts import render
from .models import Article
# Create your views here.
def index(request):
    articles = Article.objects.all()
    context = {'articles' : articles}
    return render(request, 'articles/index.html', context)
def detail(request,id):
    article = Article.objects.get(pk=id)
    context = {'article' : article}
    return render(request, 'articles/detail.html', context)
```

- articles/detail.html

```
{% extends 'base.html' %}

{% block content %}
<h1>detail</h1>

<p>글 번호: {{article.id}}</p>
<p>글 제목 : {{article.title}}</p>
<p>글 내용 : {{article.content}}</p>
<p>생성 시간: {{article.created_at}} </p>
<p>수정 시간: {{article.updated_at}}</p>

{% endblock content %}
```

---

## 내용 작성 유의

![Untitled](CRUD%20182d4c6b17fa4531a33249d3631d31a9/Untitled.png)

![Untitled](CRUD%20182d4c6b17fa4531a33249d3631d31a9/Untitled%201.png)

---

## GET, POST

![Untitled](CRUD%20182d4c6b17fa4531a33249d3631d31a9/Untitled%202.png)

![Untitled](CRUD%20182d4c6b17fa4531a33249d3631d31a9/Untitled%203.png)

![Untitled](CRUD%20182d4c6b17fa4531a33249d3631d31a9/Untitled%204.png)

---

## 총 정리

### articles

- urls.py

```python
from django.urls import path
from . import views

app_name = "articles"
urlpatterns = [
    path('', views.index, name='index'),
    path('<int:id>/',views.detail, name='detail'),
    path('new/', views.new, name='new'),
    path('create/', views.create, name='create')
]
```

- views.py

```python
from django.shortcuts import render,redirect
from .models import Article

# Create your views here.
def index(request):
    articles = Article.objects.all()
    context = {'articles' : articles}
    return render(request, 'articles/index.html', context)
def detail(request,id):
    article = Article.objects.get(pk=id)
    context = {'article' : article}
    return render(request, 'articles/detail.html', context)
def new(request):
    return render(request,'articles/new.html')

def create(request):
    title = request.POST.get('title')
    content = request.POST.get('content')
    Article.objects.create(title=title, content=content)
    # 
    return redirect('articles:index')
```

- index.html

```
{% extends 'base.html' %}

{% block content %}
<h1>INDEX</h1>
<a href="{% url 'articles:new' %}">글 작성하러 가기</a>
<br>
<hr>
{% for article in articles %}
<p>글 번호: {{article.id}}</p>
<a href="{% url 'articles:detail' article.id %}">글 제목 : {{article.title}}</a>
<p>글 내용 : {{article.content}}</p>
<hr>

{% endfor %}
{% endblock content %}
```

- detail.html

```
{% extends 'base.html' %}

{% block content %}
<h1>detail</h1>

<p>글 번호: {{article.id}}</p>
<p>글 제목 : {{article.title}}</p>
<p>글 내용 : {{article.content}}</p>
<p>생성 시간: {{article.created_at}} </p>
<p>수정 시간: {{article.updated_at}}</p>

<a href="{% url 'articles:index' %}">본문 이동</a>

{% endblock content %}
```

- new.html

```
{% extends 'base.html' %}

{% block content %}
<h1>글작성</h1>
<hr>
<form action="{% url 'articles:create' %}" method="POST">
  {% csrf_token %}
  <label for="title">제목 : </label>
  <input type="text" id="title" name="title">

  <label for="content">내용 : </label>
  <input type="text" name="content" id="content">

  <input type="submit">
</form>

{% endblock content %}
```

- models.py

```python
from django.db import models

# Create your models here.

class Article(models.Model):
    title = models.CharField(max_length=30)
    content = models.TextField()

    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)
    def __str__(self):
        return f'{self.id}번째글 - {self.title}'
```

- admin.py

```python
from django.contrib import admin
from .models import Article
# Register your models here.

admin.site.register(Article)
```

---

```python
def create(request):
    if request.method == 'POST':
        title = request.POST.get('title')
        content = request.POST.get('content')
        article = Article(title=title, content=content)
        article.save()
        return redirect('articles:index')
    else: 
        return render(request, 'articles/create.html')
```

```python
def update(request, pk):
    if request.method == 'POST':
        article = Article.objects.get(id=pk)
        article.title = request.POST.get('title')
        article.content = request.POST.get('content')
        article.save()
        return redirect('articles:detail', pk)
    else:
        article = Article.objects.get(id=pk)
        context = {
            'article': article
        }
        return render(request, 'articles/update.html', context)
```

이런식으로 request.method 방식에 따라 같은 기능을 담당하는 두 개를 구분하여 한 함수로 두개를 처리할 수 있음

This document provides step-by-step instructions on how to build a CRUD (Create, Read, Update, Delete) system using Django. It includes code examples and explanations for each step, including how to create an admin user, how to implement CRUD functionality, and how to handle GET and POST requests. The final section provides a complete summary of the articles app, including [urls.py](http://urls.py/), [views.py](http://views.py/), [models.py](http://models.py/), and [admin.py](http://admin.py/) code.

The first step to building a CRUD system in Django is to create a model. In this example, we will be creating an `Article` model with a `title`, `content`, `created_at`, and `updated_at` field.

```
class Article(models.Model):
    title = models.CharField(max_length=30)
    content = models.TextField()

    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

```

The `auto_now_add` and `auto_now` attributes ensure that the `created_at` field is set to the current date and time when a new `Article` object is created, and that the `updated_at` field is updated with the current date and time whenever the object is saved.

Next, we will create an admin user by running the following command in the terminal:

```
python manage.py createsuperuser

```

This will prompt you to enter a username, email, and password for the new admin user.

After creating an admin user, we need to register the `Article` model with the admin site by adding the following code to `articles/admin.py`:

```
from django.contrib import admin
from .models import Article

admin.site.register(Article)

```

This allows us to view and edit `Article` objects through the Django admin interface.

Now that we have a model and an admin user set up, we can start building the CRUD functionality. The first step is to implement the "Read" operation, which involves displaying a list of articles and individual article pages.

To do this, we will create a view called `index` in `articles/views.py` that retrieves all `Article` objects from the database and passes them to the `index.html` template:

```
from django.shortcuts import render
from .models import Article

def index(request):
    articles = Article.objects.all()
    context = {'articles' : articles}
    return render(request, 'articles/index.html', context)

```

In `articles/urls.py`, we will create a URL pattern for the `index` view:

```
from django.urls import path
from . import views

app_name = 'articles'
urlpatterns = [
    path('', views.index, name='index'),
]

```

This will allow us to access the `index` view by visiting `/articles/` in our browser.

Next, we will create a template called `index.html` in `articles/templates/articles/` that displays a list of articles:

```
{% extends 'base.html' %}

{% block content %}
<h1>INDEX</h1>

{% for article in articles %}
<p>글 번호: {{article.id}}</p>
<a href="{% url 'articles:detail' article.id %}">글 제목 : {{article.title}}</a>
<p>글 내용 : {{article.content}}</p>

{% endfor %}
{% endblock content %}

```

The `{% url 'articles:detail' article.id %}` syntax generates a URL for the `detail` view, which we will create next.

To implement the "Read" operation for individual articles, we will create a new view called `detail` in `articles/views.py` that retrieves a single `Article` object based on its `id` field and passes it to the `detail.html` template:

```
def detail(request,id):
    article = Article.objects.get(pk=id)
    context = {'article' : article}
    return render(request, 'articles/detail.html', context)

```

In `articles/urls.py`, we will create a new URL pattern for the `detail` view that includes the `id` parameter:

```
urlpatterns = [
    path('', views.index, name='index'),
    path('<int:id>/',views.detail, name='detail'),
]

```

This allows us to access the `detail` view by visiting `/articles/<id>/` in our browser.

Finally, we will create a template called `detail.html` in `articles/templates/articles/` that displays information about a single article:

```
{% extends 'base.html' %}

{% block content %}
<h1>detail</h1>

<p>글 번호: {{article.id}}</p>
<p>글 제목 : {{article.title}}</p>
<p>글 내용 : {{article.content}}</p>
<p>생성 시간: {{article.created_at}} </p>
<p>수정 시간: {{article.updated_at}}</p>

{% endblock content %}

```

With the "Read" operation complete, we can move on to implementing "Create", "Update", and "Delete" functionality. I will continue explaining this in my next message.

By default, Django doesn't automatically re-order the IDs of a model when an object is deleted. This is because changing the IDs of existing objects can lead to unexpected behavior and data inconsistencies. However, if you still want to re-order the IDs of `Article` objects when an object is deleted, you can override the `delete` method of the `Article` model in `articles/models.py`. Here's an example implementation:

```
class Article(models.Model):
    # fields...

    def __str__(self):
        return f'{self.id}번째글 - {self.title}'

    def delete(self, *args, **kwargs):
        super().delete(*args, **kwargs)
        # re-order the IDs of remaining objects
        Article.objects.all().update(id=models.F('id') - 1)

```

In this implementation, we override the `delete` method of the `Article` model to call the parent `delete` method, which deletes the object from the database. After the object is deleted, we use the `update` method to re-order the IDs of all remaining `Article` objects by subtracting 1 from their IDs.

This implementation should work for small to medium-sized databases, but for larger databases with many objects, it may not be efficient to re-order all the IDs every time an object is deleted. In those cases, you may want to consider using a custom primary key field that is not based on auto-incrementing IDs.